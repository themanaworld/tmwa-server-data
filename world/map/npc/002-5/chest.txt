// Variables used: nibble 4 and 5 of QUEST_SouthTulimshar

002-5.gat,93,37,0|script|Supply Chest|378
{
    // This NPC previously used the variable TMW_Quest
    callfunc "ClearVarTMW_Quest";

    set @state, ((QUEST_SouthTulimshar & BYTE_2_MASK) >> BYTE_2_SHIFT);

    if (@state >= 26) goto L_Finished;

    mes "Hrmm... A supply chest.";
    mes "Do you want to try to open it?";
    next;
    menu
        "Yes.", L_Yes,
        "No.", L_Close;

L_Yes:
    setarray @getitem$, "TreasureKey";
    setarray @getitem, 3;
    setarray @getitem$, "ShortBow";
    setarray @getitem, 1;
    callfunc "CheckInventory";
    if(@check_fail) close;
    mes "You opened the chest and found a short bow!";
    set @state, 26;
    callsub S_Update_Var;
    goto L_Close;

L_Finished:
    mes "You have already opened this chest.";
    goto L_Close;

L_Close:
    set @state, 0;
    close;

S_Update_Var:
    set QUEST_SouthTulimshar, (QUEST_SouthTulimshar & ~(BYTE_2_MASK) | (@state << BYTE_2_SHIFT));
    return;
}
