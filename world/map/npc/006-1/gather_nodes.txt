// Mining Nodes
// Author: wushin

// NodeManager
006-1.gat,0,0,0|script|#NodeManager22|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesTwentytwoSpawned, "", getarraysize($@NodesTwentytwoSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomTwentytwoNodeLoop, 0;
    set $@RandomTwentytwoNode, rand(getarraysize($@NodeManagerTwentytwoSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomTwentytwoNode == $@NodesTwentytwoSpawned[$@RandomTwentytwoNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomTwentytwoNodeLoop, ($@RandomTwentytwoNodeLoop + 1);
    if ($@RandomTwentytwoNodeLoop >= getarraysize($@NodesTwentytwoSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerTwentytwoSpawn[$@RandomTwentytwoNode];
    setarray $@NodesTwentytwoSpawned[$@NodeManagerTwentytwoSpawnCount], $@RandomTwentytwoNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerTwentytwoSpawnCount, ($@NodeManagerTwentytwoSpawnCount + 1);
    if ($@NodeManagerTwentytwoSpawnMax > $@NodeManagerTwentytwoSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomTwentytwoNodeLoop, 0;
    set $@RandomTwentytwoNode, rand(getarraysize($@NodeManagerTwentytwoSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomTwentytwoNode == $@NodesTwentytwoSpawned[$@RandomTwentytwoNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomTwentytwoNodeLoop, ($@RandomTwentytwoNodeLoop + 1);
    if ($@RandomTwentytwoNodeLoop >= getarraysize($@NodesTwentytwoSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerTwentytwoSpawn[$@RandomTwentytwoNode];
    setarray $@NodesTwentytwoSpawned[$@DisableTwentytwoSpawnsLoop], $@RandomTwentytwoNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableTwentytwoSpawnsLoop, ($@DisableTwentytwoSpawnsLoop + 1);
    if ($@NodeManagerTwentytwoSpawnMax > $@DisableTwentytwoSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerTwentytwoSpawnCount, ($@NodeManagerTwentytwoSpawnCount - 1);
    if ($@NodeManagerTwentytwoSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableTwentytwoSpawnsLoop, 0;
    set $@NodeManagerTwentytwoSpawnMax, 3;
    set $@NodeManagerTwentytwoSpawnCount, 3;
    setarray $@NodeManagerTwentytwoSpawn, 127, 128, 129, 130, 131, 132;
    cleararray $@NodesTwentytwoSpawned, "", getarraysize($@NodesTwentytwoSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
006-1.gat,23,43,0|script|#Node127|604,
{
    set @NodeId, 127;
    set @NodeManagerId, 22;
    setarray @npc_loc, 23, 43, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
006-1.gat,39,46,0|script|#Node128|604,
{
    set @NodeId, 128;
    set @NodeManagerId, 22;
    setarray @npc_loc, 39, 46, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
006-1.gat,72,86,0|script|#Node129|604,
{
    set @NodeId, 129;
    set @NodeManagerId, 22;
    setarray @npc_loc, 72, 86, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
006-1.gat,121,97,0|script|#Node130|604,
{
    set @NodeId, 130;
    set @NodeManagerId, 22;
    setarray @npc_loc, 121, 97, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
006-1.gat,120,115,0|script|#Node131|604,
{
    set @NodeId, 131;
    set @NodeManagerId, 22;
    setarray @npc_loc, 120, 115, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
006-1.gat,88,28,0|script|#Node132|604,
{
    set @NodeId, 132;
    set @NodeManagerId, 22;
    setarray @npc_loc, 88, 28, 2;
    callfunc "AlizarinPlant";
    end;
}
