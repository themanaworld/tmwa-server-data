// Mining Nodes
// Author: wushin

// NodeManager
023-1.gat,0,0,0|script|#NodeManager35|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesThrityfiveSpawned, "", getarraysize($@NodesThrityfiveSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomThrityfiveNodeLoop, 0;
    set $@RandomThrityfiveNode, rand(getarraysize($@NodeManagerThrityfiveSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomThrityfiveNode == $@NodesThrityfiveSpawned[$@RandomThrityfiveNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomThrityfiveNodeLoop, ($@RandomThrityfiveNodeLoop + 1);
    if ($@RandomThrityfiveNodeLoop >= getarraysize($@NodesThrityfiveSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerThrityfiveSpawn[$@RandomThrityfiveNode];
    setarray $@NodesThrityfiveSpawned[$@NodeManagerThrityfiveSpawnCount], $@RandomThrityfiveNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerThrityfiveSpawnCount, ($@NodeManagerThrityfiveSpawnCount + 1);
    if ($@NodeManagerThrityfiveSpawnMax > $@NodeManagerThrityfiveSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomThrityfiveNodeLoop, 0;
    set $@RandomThrityfiveNode, rand(getarraysize($@NodeManagerThrityfiveSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomThrityfiveNode == $@NodesThrityfiveSpawned[$@RandomThrityfiveNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomThrityfiveNodeLoop, ($@RandomThrityfiveNodeLoop + 1);
    if ($@RandomThrityfiveNodeLoop >= getarraysize($@NodesThrityfiveSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerThrityfiveSpawn[$@RandomThrityfiveNode];
    setarray $@NodesThrityfiveSpawned[$@DisableThrityfiveSpawnsLoop], $@RandomThrityfiveNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableThrityfiveSpawnsLoop, ($@DisableThrityfiveSpawnsLoop + 1);
    if ($@NodeManagerThrityfiveSpawnMax > $@DisableThrityfiveSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerThrityfiveSpawnCount, ($@NodeManagerThrityfiveSpawnCount - 1);
    if ($@NodeManagerThrityfiveSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableThrityfiveSpawnsLoop, 0;
    set $@NodeManagerThrityfiveSpawnMax, 4;
    set $@NodeManagerThrityfiveSpawnCount, 4;
    setarray $@NodeManagerThrityfiveSpawn, 220, 221, 222, 223, 224, 225, 226, 227;
    cleararray $@NodesThrityfiveSpawned, "", getarraysize($@NodesThrityfiveSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
023-1.gat,112,114,0|script|#Node220|608,
{
    set @NodeId, 220;
    set @NodeManagerId, 35;
    setarray @npc_loc, 112, 114, 2;
    callfunc "ClamShell";
    end;
}

// Gather Node NPC
023-1.gat,50,119,0|script|#Node221|608,
{
    set @NodeId, 221;
    set @NodeManagerId, 35;
    setarray @npc_loc, 50, 119, 2;
    callfunc "ClamShell";
    end;
}

// Gather Node NPC
023-1.gat,31,44,0|script|#Node222|608,
{
    set @NodeId, 222;
    set @NodeManagerId, 35;
    setarray @npc_loc, 31, 44, 2;
    callfunc "ClamShell";
    end;
}

// Gather Node NPC
023-1.gat,68,26,0|script|#Node223|608,
{
    set @NodeId, 223;
    set @NodeManagerId, 35;
    setarray @npc_loc, 68, 26, 2;
    callfunc "ClamShell";
    end;
}

// Gather Node NPC
023-1.gat,73,64,0|script|#Node224|608,
{
    set @NodeId, 224;
    set @NodeManagerId, 35;
    setarray @npc_loc, 73, 64, 2;
    callfunc "ClamShell";
    end;
}

// Gather Node NPC
023-1.gat,101,33,0|script|#Node225|608,
{
    set @NodeId, 225;
    set @NodeManagerId, 35;
    setarray @npc_loc, 101, 33, 2;
    callfunc "ClamShell";
    end;
}
// Gather Node NPC
023-1.gat,81,58,0|script|#Node226|608,
{
    set @NodeId, 226;
    set @NodeManagerId, 35;
    setarray @npc_loc, 81, 58, 2;
    callfunc "ClamShell";
    end;
}
// Gather Node NPC
023-1.gat,112,98,0|script|#Node227|608,
{
    set @NodeId, 227;
    set @NodeManagerId, 35;
    setarray @npc_loc, 112, 98, 2;
    callfunc "ClamShell";
    end;
}
