// Mining Nodes
// Author: wushin

// NodeManager
008-1.gat,0,0,0|script|#NodeManager24|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesTwentyfourSpawned, "", getarraysize($@NodesTwentyfourSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomTwentyfourNodeLoop, 0;
    set $@RandomTwentyfourNode, rand(getarraysize($@NodeManagerTwentyfourSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomTwentyfourNode == $@NodesTwentyfourSpawned[$@RandomTwentyfourNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomTwentyfourNodeLoop, ($@RandomTwentyfourNodeLoop + 1);
    if ($@RandomTwentyfourNodeLoop >= getarraysize($@NodesTwentyfourSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerTwentyfourSpawn[$@RandomTwentyfourNode];
    setarray $@NodesTwentyfourSpawned[$@NodeManagerTwentyfourSpawnCount], $@RandomTwentyfourNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerTwentyfourSpawnCount, ($@NodeManagerTwentyfourSpawnCount + 1);
    if ($@NodeManagerTwentyfourSpawnMax > $@NodeManagerTwentyfourSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomTwentyfourNodeLoop, 0;
    set $@RandomTwentyfourNode, rand(getarraysize($@NodeManagerTwentyfourSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomTwentyfourNode == $@NodesTwentyfourSpawned[$@RandomTwentyfourNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomTwentyfourNodeLoop, ($@RandomTwentyfourNodeLoop + 1);
    if ($@RandomTwentyfourNodeLoop >= getarraysize($@NodesTwentyfourSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerTwentyfourSpawn[$@RandomTwentyfourNode];
    setarray $@NodesTwentyfourSpawned[$@DisableTwentyfourSpawnsLoop], $@RandomTwentyfourNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableTwentyfourSpawnsLoop, ($@DisableTwentyfourSpawnsLoop + 1);
    if ($@NodeManagerTwentyfourSpawnMax > $@DisableTwentyfourSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerTwentyfourSpawnCount, ($@NodeManagerTwentyfourSpawnCount - 1);
    if ($@NodeManagerTwentyfourSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableTwentyfourSpawnsLoop, 0;
    set $@NodeManagerTwentyfourSpawnMax, 3;
    set $@NodeManagerTwentyfourSpawnCount, 3;
    setarray $@NodeManagerTwentyfourSpawn, 139, 140, 141, 142, 143, 144;
    cleararray $@NodesTwentyfourSpawned, "", getarraysize($@NodesTwentyfourSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
008-1.gat,44,25,0|script|#Node139|601,
{
    set @NodeId, 139;
    set @NodeManagerId, 24;
    setarray @npc_loc, 44, 25, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
008-1.gat,125,22,0|script|#Node140|601,
{
    set @NodeId, 140;
    set @NodeManagerId, 24;
    setarray @npc_loc, 125, 22, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
008-1.gat,135,79,0|script|#Node141|601,
{
    set @NodeId, 141;
    set @NodeManagerId, 24;
    setarray @npc_loc, 135, 79, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
008-1.gat,108,94,0|script|#Node142|601,
{
    set @NodeId, 142;
    set @NodeManagerId, 24;
    setarray @npc_loc, 108, 94, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
008-1.gat,65,90,0|script|#Node143|601,
{
    set @NodeId, 143;
    set @NodeManagerId, 24;
    setarray @npc_loc, 65, 90, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
008-1.gat,100,43,0|script|#Node144|601,
{
    set @NodeId, 144;
    set @NodeManagerId, 24;
    setarray @npc_loc, 100, 43, 2;
    callfunc "MauvePlant";
    end;
}
