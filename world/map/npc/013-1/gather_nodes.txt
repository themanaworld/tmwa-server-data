// Mining Nodes
// Author: wushin

// NodeManager
013-1.gat,0,0,0|script|#NodeManager28|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesTwentyeightSpawned, "", getarraysize($@NodesTwentyeightSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomTwentyeightNodeLoop, 0;
    set $@RandomTwentyeightNode, rand(getarraysize($@NodeManagerTwentyeightSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomTwentyeightNode == $@NodesTwentyeightSpawned[$@RandomTwentyeightNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomTwentyeightNodeLoop, ($@RandomTwentyeightNodeLoop + 1);
    if ($@RandomTwentyeightNodeLoop >= getarraysize($@NodesTwentyeightSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerTwentyeightSpawn[$@RandomTwentyeightNode];
    setarray $@NodesTwentyeightSpawned[$@NodeManagerTwentyeightSpawnCount], $@RandomTwentyeightNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerTwentyeightSpawnCount, ($@NodeManagerTwentyeightSpawnCount + 1);
    if ($@NodeManagerTwentyeightSpawnMax > $@NodeManagerTwentyeightSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomTwentyeightNodeLoop, 0;
    set $@RandomTwentyeightNode, rand(getarraysize($@NodeManagerTwentyeightSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomTwentyeightNode == $@NodesTwentyeightSpawned[$@RandomTwentyeightNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomTwentyeightNodeLoop, ($@RandomTwentyeightNodeLoop + 1);
    if ($@RandomTwentyeightNodeLoop >= getarraysize($@NodesTwentyeightSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerTwentyeightSpawn[$@RandomTwentyeightNode];
    setarray $@NodesTwentyeightSpawned[$@DisableTwentyeightSpawnsLoop], $@RandomTwentyeightNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableTwentyeightSpawnsLoop, ($@DisableTwentyeightSpawnsLoop + 1);
    if ($@NodeManagerTwentyeightSpawnMax > $@DisableTwentyeightSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerTwentyeightSpawnCount, ($@NodeManagerTwentyeightSpawnCount - 1);
    if ($@NodeManagerTwentyeightSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableTwentyeightSpawnsLoop, 0;
    set $@NodeManagerTwentyeightSpawnMax, 3;
    set $@NodeManagerTwentyeightSpawnCount, 3;
    setarray $@NodeManagerTwentyeightSpawn, 174, 175, 176, 177, 178, 179;
    cleararray $@NodesTwentyeightSpawned, "", getarraysize($@NodesTwentyeightSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
013-1.gat,52,52,0|script|#Node174|601,
{
    set @NodeId, 174;
    set @NodeManagerId, 28;
    setarray @npc_loc, 52, 52, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
013-1.gat,79,61,0|script|#Node175|606,
{
    set @NodeId, 175;
    set @NodeManagerId, 28;
    setarray @npc_loc, 79, 61, 2;
    callfunc "Mushroom";
    end;
}

// Gather Node NPC
013-1.gat,80,78,0|script|#Node176|606,
{
    set @NodeId, 176;
    set @NodeManagerId, 28;
    setarray @npc_loc, 80, 78, 2;
    callfunc "Mushroom";
    end;
}

// Gather Node NPC
013-1.gat,106,64,0|script|#Node177|601,
{
    set @NodeId, 177;
    set @NodeManagerId, 28;
    setarray @npc_loc, 106, 64, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
013-1.gat,90,26,0|script|#Node178|601,
{
    set @NodeId, 178;
    set @NodeManagerId, 28;
    setarray @npc_loc, 90, 26, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
013-1.gat,99,88,0|script|#Node179|601,
{
    set @NodeId, 179;
    set @NodeManagerId, 28;
    setarray @npc_loc, 99, 88, 2;
    callfunc "MauvePlant";
    end;
}
