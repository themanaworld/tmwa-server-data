// Mining Nodes
// Author: wushin

// NodeManager
017-1.gat,0,0,0|script|#NodeManager32|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesThritytwoSpawned, "", getarraysize($@NodesThritytwoSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomThritytwoNodeLoop, 0;
    set $@RandomThritytwoNode, rand(getarraysize($@NodeManagerThritytwoSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomThritytwoNode == $@NodesThritytwoSpawned[$@RandomThritytwoNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomThritytwoNodeLoop, ($@RandomThritytwoNodeLoop + 1);
    if ($@RandomThritytwoNodeLoop >= getarraysize($@NodesThritytwoSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerThritytwoSpawn[$@RandomThritytwoNode];
    setarray $@NodesThritytwoSpawned[$@NodeManagerThritytwoSpawnCount], $@RandomThritytwoNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerThritytwoSpawnCount, ($@NodeManagerThritytwoSpawnCount + 1);
    if ($@NodeManagerThritytwoSpawnMax > $@NodeManagerThritytwoSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomThritytwoNodeLoop, 0;
    set $@RandomThritytwoNode, rand(getarraysize($@NodeManagerThritytwoSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomThritytwoNode == $@NodesThritytwoSpawned[$@RandomThritytwoNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomThritytwoNodeLoop, ($@RandomThritytwoNodeLoop + 1);
    if ($@RandomThritytwoNodeLoop >= getarraysize($@NodesThritytwoSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerThritytwoSpawn[$@RandomThritytwoNode];
    setarray $@NodesThritytwoSpawned[$@DisableThritytwoSpawnsLoop], $@RandomThritytwoNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableThritytwoSpawnsLoop, ($@DisableThritytwoSpawnsLoop + 1);
    if ($@NodeManagerThritytwoSpawnMax > $@DisableThritytwoSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerThritytwoSpawnCount, ($@NodeManagerThritytwoSpawnCount - 1);
    if ($@NodeManagerThritytwoSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableThritytwoSpawnsLoop, 0;
    set $@NodeManagerThritytwoSpawnMax, 4;
    set $@NodeManagerThritytwoSpawnCount, 4;
    setarray $@NodeManagerThritytwoSpawn, 200, 201, 202, 203, 204, 205, 206, 207;
    cleararray $@NodesThritytwoSpawned, "", getarraysize($@NodesThritytwoSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
017-1.gat,23,26,0|script|#Node200|605,
{
    set @NodeId, 200;
    set @NodeManagerId, 32;
    setarray @npc_loc, 23, 26, 2;
    callfunc "CloverPatch";
    end;
}

// Gather Node NPC
017-1.gat,100,31,0|script|#Node201|605,
{
    set @NodeId, 201;
    set @NodeManagerId, 32;
    setarray @npc_loc, 100, 31, 2;
    callfunc "CloverPatch";
    end;
}

// Gather Node NPC
017-1.gat,38,76,0|script|#Node202|601,
{
    set @NodeId, 202;
    set @NodeManagerId, 32;
    setarray @npc_loc, 38, 76, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
017-1.gat,67,52,0|script|#Node203|601,
{
    set @NodeId, 203;
    set @NodeManagerId, 32;
    setarray @npc_loc, 67, 52, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
017-1.gat,55,44,0|script|#Node204|601,
{
    set @NodeId, 204;
    set @NodeManagerId, 32;
    setarray @npc_loc, 55, 44, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
017-1.gat,122,32,0|script|#Node205|601,
{
    set @NodeId, 205;
    set @NodeManagerId, 32;
    setarray @npc_loc, 122, 32, 2;
    callfunc "MauvePlant";
    end;
}
// Gather Node NPC
017-1.gat,128,22,0|script|#Node206|603,
{
    set @NodeId, 206;
    set @NodeManagerId, 32;
    setarray @npc_loc, 128, 22, 2;
    callfunc "GambrogePlant";
    end;
}
// Gather Node NPC
017-1.gat,109,69,0|script|#Node207|606,
{
    set @NodeId, 207;
    set @NodeManagerId, 32;
    setarray @npc_loc, 109, 69, 2;
    callfunc "CloverPatch";
    end;
}
