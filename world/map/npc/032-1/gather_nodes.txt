// Mining Nodes
// Author: wushin

// NodeManager
032-1.gat,0,0,0|script|#NodeManager45|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesFortyfiveSpawned, "", getarraysize($@NodesFortyfiveSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomFortyfiveNodeLoop, 0;
    set $@RandomFortyfiveNode, rand(getarraysize($@NodeManagerFortyfiveSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomFortyfiveNode == $@NodesFortyfiveSpawned[$@RandomFortyfiveNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomFortyfiveNodeLoop, ($@RandomFortyfiveNodeLoop + 1);
    if ($@RandomFortyfiveNodeLoop >= getarraysize($@NodesFortyfiveSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerFortyfiveSpawn[$@RandomFortyfiveNode];
    setarray $@NodesFortyfiveSpawned[$@NodeManagerFortyfiveSpawnCount], $@RandomFortyfiveNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerFortyfiveSpawnCount, ($@NodeManagerFortyfiveSpawnCount + 1);
    if ($@NodeManagerFortyfiveSpawnMax > $@NodeManagerFortyfiveSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomFortyfiveNodeLoop, 0;
    set $@RandomFortyfiveNode, rand(getarraysize($@NodeManagerFortyfiveSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomFortyfiveNode == $@NodesFortyfiveSpawned[$@RandomFortyfiveNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomFortyfiveNodeLoop, ($@RandomFortyfiveNodeLoop + 1);
    if ($@RandomFortyfiveNodeLoop >= getarraysize($@NodesFortyfiveSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerFortyfiveSpawn[$@RandomFortyfiveNode];
    setarray $@NodesFortyfiveSpawned[$@DisableFortyfiveSpawnsLoop], $@RandomFortyfiveNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableFortyfiveSpawnsLoop, ($@DisableFortyfiveSpawnsLoop + 1);
    if ($@NodeManagerFortyfiveSpawnMax > $@DisableFortyfiveSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerFortyfiveSpawnCount, ($@NodeManagerFortyfiveSpawnCount - 1);
    if ($@NodeManagerFortyfiveSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableFortyfiveSpawnsLoop, 0;
    set $@NodeManagerFortyfiveSpawnMax, 3;
    set $@NodeManagerFortyfiveSpawnCount, 3;
    setarray $@NodeManagerFortyfiveSpawn, 285, 286, 287, 288, 289, 290;
    cleararray $@NodesFortyfiveSpawned, "", getarraysize($@NodesFortyfiveSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
032-1.gat,77,21,0|script|#Node285|604,
{
    set @NodeId, 285;
    set @NodeManagerId, 45;
    setarray @npc_loc, 77, 21, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
032-1.gat,24,19,0|script|#Node286|604,
{
    set @NodeId, 286;
    set @NodeManagerId, 45;
    setarray @npc_loc, 24, 19, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
032-1.gat,87,73,0|script|#Node287|604,
{
    set @NodeId, 287;
    set @NodeManagerId, 45;
    setarray @npc_loc, 87, 73, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
032-1.gat,51,41,0|script|#Node288|604,
{
    set @NodeId, 288;
    set @NodeManagerId, 45;
    setarray @npc_loc, 51, 41, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
032-1.gat,14,79,0|script|#Node289|604,
{
    set @NodeId, 289;
    set @NodeManagerId, 45;
    setarray @npc_loc, 14, 79, 2;
    callfunc "AlizarinPlant";
    end;
}

// Gather Node NPC
032-1.gat,47,80,0|script|#Node290|604,
{
    set @NodeId, 290;
    set @NodeManagerId, 45;
    setarray @npc_loc, 47, 80, 2;
    callfunc "AlizarinPlant";
    end;
}
