// Mining Nodes
// Author: wushin

// NodeManager
043-3.gat,0,0,0|script|#NodeManager15|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesFifteenSpawned, "", getarraysize($@NodesFifteenSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomFifteenNodeLoop, 0;
    set $@RandomFifteenNode, rand(getarraysize($@NodeManagerFifteenSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomFifteenNode == $@NodesFifteenSpawned[$@RandomFifteenNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomFifteenNodeLoop, ($@RandomFifteenNodeLoop + 1);
    if ($@RandomFifteenNodeLoop >= getarraysize($@NodesFifteenSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerFifteenSpawn[$@RandomFifteenNode];
    setarray $@NodesFifteenSpawned[$@NodeManagerFifteenSpawnCount], $@RandomFifteenNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerFifteenSpawnCount, ($@NodeManagerFifteenSpawnCount + 1);
    if ($@NodeManagerFifteenSpawnMax > $@NodeManagerFifteenSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomFifteenNodeLoop, 0;
    set $@RandomFifteenNode, rand(getarraysize($@NodeManagerFifteenSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomFifteenNode == $@NodesFifteenSpawned[$@RandomFifteenNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomFifteenNodeLoop, ($@RandomFifteenNodeLoop + 1);
    if ($@RandomFifteenNodeLoop >= getarraysize($@NodesFifteenSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerFifteenSpawn[$@RandomFifteenNode];
    setarray $@NodesFifteenSpawned[$@DisableFifteenSpawnsLoop], $@RandomFifteenNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableFifteenSpawnsLoop, ($@DisableFifteenSpawnsLoop + 1);
    if ($@NodeManagerFifteenSpawnMax > $@DisableFifteenSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerFifteenSpawnCount, ($@NodeManagerFifteenSpawnCount - 1);
    if ($@NodeManagerFifteenSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableFifteenSpawnsLoop, 0;
    set $@NodeManagerFifteenSpawnMax, 3;
    set $@NodeManagerFifteenSpawnCount, 3;
    setarray $@NodeManagerFifteenSpawn, 85, 86, 87, 88, 89, 90;
    cleararray $@NodesFifteenSpawned, "", getarraysize($@NodesFifteenSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
043-3.gat,27,95,0|script|#Node85|501,
{
    set @NodeId, 85;
    set @NodeManagerId, 15;
    setarray @npc_loc, 27, 95, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
043-3.gat,106,110,0|script|#Node86|501,
{
    set @NodeId, 86;
    set @NodeManagerId, 15;
    setarray @npc_loc, 106, 110, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
043-3.gat,119,74,0|script|#Node87|501,
{
    set @NodeId, 87;
    set @NodeManagerId, 15;
    setarray @npc_loc, 119, 74, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
043-3.gat,108,37,0|script|#Node88|501,
{
    set @NodeId, 88;
    set @NodeManagerId, 15;
    setarray @npc_loc, 108, 37, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
043-3.gat,112,52,0|script|#Node89|501,
{
    set @NodeId, 89;
    set @NodeManagerId, 15;
    setarray @npc_loc, 112, 52, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
043-3.gat,54,84,0|script|#Node90|501,
{
    set @NodeId, 90;
    set @NodeManagerId, 15;
    setarray @npc_loc, 54, 84, 2;
    callfunc "CoalVein";
    end;
}
