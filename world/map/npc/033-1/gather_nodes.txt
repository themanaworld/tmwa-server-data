// Mining Nodes
// Author: wushin
// NodeManager
033-1.gat,0,0,0|script|#NodeManager51|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesFiftyoneSpawned, "", getarraysize($@NodesFiftyoneSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomFiftyoneNodeLoop, 0;
    set $@RandomFiftyoneNode, rand(getarraysize($@NodeManagerFiftyoneSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomFiftyoneNode == $@NodesFiftyoneSpawned[$@RandomFiftyoneNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomFiftyoneNodeLoop, ($@RandomFiftyoneNodeLoop + 1);
    if ($@RandomFiftyoneNodeLoop >= getarraysize($@NodesFiftyoneSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerFiftyoneSpawn[$@RandomFiftyoneNode];
    setarray $@NodesFiftyoneSpawned[$@NodeManagerFiftyoneSpawnCount], $@RandomFiftyoneNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerFiftyoneSpawnCount, ($@NodeManagerFiftyoneSpawnCount + 1);
    if ($@NodeManagerFiftyoneSpawnMax > $@NodeManagerFiftyoneSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomFiftyoneNodeLoop, 0;
    set $@RandomFiftyoneNode, rand(getarraysize($@NodeManagerFiftyoneSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomFiftyoneNode == $@NodesFiftyoneSpawned[$@RandomFiftyoneNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomFiftyoneNodeLoop, ($@RandomFiftyoneNodeLoop + 1);
    if ($@RandomFiftyoneNodeLoop >= getarraysize($@NodesFiftyoneSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerFiftyoneSpawn[$@RandomFiftyoneNode];
    setarray $@NodesFiftyoneSpawned[$@DisableFiftyoneSpawnsLoop], $@RandomFiftyoneNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableFiftyoneSpawnsLoop, ($@DisableFiftyoneSpawnsLoop + 1);
    if ($@NodeManagerFiftyoneSpawnMax > $@DisableFiftyoneSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerFiftyoneSpawnCount, ($@NodeManagerFiftyoneSpawnCount - 1);
    if ($@NodeManagerFiftyoneSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableFiftyoneSpawnsLoop, 0;
    set $@NodeManagerFiftyoneSpawnMax, 3;
    set $@NodeManagerFiftyoneSpawnCount, 3;
    setarray $@NodeManagerFiftyoneSpawn, 321, 322, 323, 324, 325, 326;
    cleararray $@NodesFiftyoneSpawned, "", getarraysize($@NodesFiftyoneSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}
// Gather Node NPC
033-1.gat,72,24,0|script|#Node321|602,
{
    set @NodeId, 321;
    set @NodeManagerId, 51;
    setarray @npc_loc, 72, 24, 2;
    callfunc "CobaltPlant";
    end;
}
// Gather Node NPC
033-1.gat,72,36,0|script|#Node322|602,
{
    set @NodeId, 322;
    set @NodeManagerId, 51;
    setarray @npc_loc, 72, 36, 2;
    callfunc "CobaltPlant";
    end;
}
// Gather Node NPC
033-1.gat,28,30,0|script|#Node323|602,
{
    set @NodeId, 323;
    set @NodeManagerId, 51;
    setarray @npc_loc, 28, 30, 2;
    callfunc "CobaltPlant";
    end;
}
// Gather Node NPC
033-1.gat,64,51,0|script|#Node324|602,
{
    set @NodeId, 324;
    set @NodeManagerId, 51;
    setarray @npc_loc, 64, 51, 2;
    callfunc "CobaltPlant";
    end;
}
// Gather Node NPC
033-1.gat,74,72,0|script|#Node325|602,
{
    set @NodeId, 325;
    set @NodeManagerId, 51;
    setarray @npc_loc, 74, 72, 2;
    callfunc "CobaltPlant";
    end;
}
// Gather Node NPC
033-1.gat,31,40,0|script|#Node326|602,
{
    set @NodeId, 326;
    set @NodeManagerId, 51;
    setarray @npc_loc, 31, 40, 2;
    callfunc "CobaltPlant";
    end;
}
// NodeManager
033-1.gat,0,0,0|script|#NodeManager52|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesFiftytwoSpawned, "", getarraysize($@NodesFiftytwoSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomFiftytwoNodeLoop, 0;
    set $@RandomFiftytwoNode, rand(getarraysize($@NodeManagerFiftytwoSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomFiftytwoNode == $@NodesFiftytwoSpawned[$@RandomFiftytwoNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomFiftytwoNodeLoop, ($@RandomFiftytwoNodeLoop + 1);
    if ($@RandomFiftytwoNodeLoop >= getarraysize($@NodesFiftytwoSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerFiftytwoSpawn[$@RandomFiftytwoNode];
    setarray $@NodesFiftytwoSpawned[$@NodeManagerFiftytwoSpawnCount], $@RandomFiftytwoNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerFiftytwoSpawnCount, ($@NodeManagerFiftytwoSpawnCount + 1);
    if ($@NodeManagerFiftytwoSpawnMax > $@NodeManagerFiftytwoSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomFiftytwoNodeLoop, 0;
    set $@RandomFiftytwoNode, rand(getarraysize($@NodeManagerFiftytwoSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomFiftytwoNode == $@NodesFiftytwoSpawned[$@RandomFiftytwoNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomFiftytwoNodeLoop, ($@RandomFiftytwoNodeLoop + 1);
    if ($@RandomFiftytwoNodeLoop >= getarraysize($@NodesFiftytwoSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerFiftytwoSpawn[$@RandomFiftytwoNode];
    setarray $@NodesFiftytwoSpawned[$@DisableFiftytwoSpawnsLoop], $@RandomFiftytwoNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableFiftytwoSpawnsLoop, ($@DisableFiftytwoSpawnsLoop + 1);
    if ($@NodeManagerFiftytwoSpawnMax > $@DisableFiftytwoSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerFiftytwoSpawnCount, ($@NodeManagerFiftytwoSpawnCount - 1);
    if ($@NodeManagerFiftytwoSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableFiftytwoSpawnsLoop, 0;
    set $@NodeManagerFiftytwoSpawnMax, 3;
    set $@NodeManagerFiftytwoSpawnCount, 3;
    setarray $@NodeManagerFiftytwoSpawn, 327, 328, 329, 330, 331, 332;
    cleararray $@NodesFiftytwoSpawned, "", getarraysize($@NodesFiftytwoSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}
// Gather Node NPC
033-1.gat,78,86,0|script|#Node327|609,
{
    set @NodeId, 327;
    set @NodeManagerId, 52;
    setarray @npc_loc, 78, 86, 2;
    callfunc "IceCube";
    end;
}
// Gather Node NPC
033-1.gat,110,71,0|script|#Node328|609,
{
    set @NodeId, 328;
    set @NodeManagerId, 52;
    setarray @npc_loc, 110, 71, 2;
    callfunc "IceCube";
    end;
}
// Gather Node NPC
033-1.gat,73,41,0|script|#Node329|609,
{
    set @NodeId, 329;
    set @NodeManagerId, 52;
    setarray @npc_loc, 73, 41, 2;
    callfunc "IceCube";
    end;
}
// Gather Node NPC
033-1.gat,77,35,0|script|#Node330|609,
{
    set @NodeId, 330;
    set @NodeManagerId, 52;
    setarray @npc_loc, 77, 35, 2;
    callfunc "IceCube";
    end;
}
// Gather Node NPC
033-1.gat,48,97,0|script|#Node331|609,
{
    set @NodeId, 331;
    set @NodeManagerId, 52;
    setarray @npc_loc, 48, 97, 2;
    callfunc "IceCube";
    end;
}
// Gather Node NPC
033-1.gat,65,98,0|script|#Node332|609,
{
    set @NodeId, 332;
    set @NodeManagerId, 52;
    setarray @npc_loc, 65, 98, 2;
    callfunc "IceCube";
    end;
}
