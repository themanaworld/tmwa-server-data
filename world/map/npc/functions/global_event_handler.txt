// This is the global event dispatcher
// Do not add code to this file. Please only add callfuncs
//
// Author: meko

-|script|#GlobalHandler|32767
{
    end;

OnPCLoginEvent:
    set @login_event, 1;
    callfunc "fixHeadStyles"; // convert headstyles
    callfunc "ClearVariables"; // removes / converts old variables
    callfunc "DisplayMOTD"; // send the motd to the client, if enabled
    callfunc "getBroadcast"; // get the scheduled broadcast, if any
    addtimer 0, "Magic Timer::OnLogin"; // prevent cast rate abuse
    callfunc "MaybeGiveBirthday";
    callfunc "MiriamExpire"; // force the speed skill quest to expire
    callfunc "ConvertChristmas21"; // Christmas 2021
    callfunc "VaultLogin"; // Mirror Lake Protocol biddings
    // add more here
    set @login_event, 2;
    end;

OnPCKillEvent:
    callfunc "elanore_decrease_exp"; // decrease heal exp for doing bad things
    callfunc "SweetTooth";
    end;

OnMobKillEvent:
    callfunc "MobPoints";
    callfunc "SweetTooth";
    end;

OnPCDieEvent:
    set @necromancer, 0;
    addtimer 0, "Magic Timer::OnClear"; // reset magic block on death
    callfunc "SpawnGhost";
    callfunc "MiriamExpire"; // force the speed skill quest to expire
    set @killerrid, 0; // reset killer rid
    set TowelLastUsed, gettimetick(2); // reset towel cooldown timer
    end;

OnPCLogoutEvent:
    callfunc "VaultLogout";
    end;

OnInit:
    callfunc "ClearGlobalVars";
    callfunc "MOTD"; // set the MOTD array

    debugmes "Bitwise test BEGIN";
    set $@VARTEST, 10;
    debugmes "VarTEST is "+$@VARTEST;
    void call("set_byte", $@VARTEST, 2, 14);
    debugmes "VarTEST is "+$@VARTEST;
    set $@TMPTEST, call("get_byte", $@VARTEST, 2);
    debugmes "Byte 2 is "+$@TMPTEST;
    void call("set_nibble", $@VARTEST, 6, 9);
    debugmes "VarTEST is "+$@VARTEST;
    set $@TMPTEST, call("get_nibble", $@VARTEST, 6);
    debugmes "Nibble 6 is "+$@TMPTEST;
    set $@TMPTEST, 0;
    set $@VARTEST, 0;
    end;

OnDay0411:
    callfunc "MaybeAnnounceBirthday";
    end;
}
