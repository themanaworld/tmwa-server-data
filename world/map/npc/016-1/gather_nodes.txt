// Mining Nodes
// Author: wushin

// NodeManager
016-1.gat,0,0,0|script|#NodeManager31|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesThrityoneSpawned, "", getarraysize($@NodesThrityoneSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomThrityoneNodeLoop, 0;
    set $@RandomThrityoneNode, rand(getarraysize($@NodeManagerThrityoneSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomThrityoneNode == $@NodesThrityoneSpawned[$@RandomThrityoneNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomThrityoneNodeLoop, ($@RandomThrityoneNodeLoop + 1);
    if ($@RandomThrityoneNodeLoop >= getarraysize($@NodesThrityoneSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerThrityoneSpawn[$@RandomThrityoneNode];
    setarray $@NodesThrityoneSpawned[$@NodeManagerThrityoneSpawnCount], $@RandomThrityoneNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerThrityoneSpawnCount, ($@NodeManagerThrityoneSpawnCount + 1);
    if ($@NodeManagerThrityoneSpawnMax > $@NodeManagerThrityoneSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomThrityoneNodeLoop, 0;
    set $@RandomThrityoneNode, rand(getarraysize($@NodeManagerThrityoneSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomThrityoneNode == $@NodesThrityoneSpawned[$@RandomThrityoneNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomThrityoneNodeLoop, ($@RandomThrityoneNodeLoop + 1);
    if ($@RandomThrityoneNodeLoop >= getarraysize($@NodesThrityoneSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerThrityoneSpawn[$@RandomThrityoneNode];
    setarray $@NodesThrityoneSpawned[$@DisableThrityoneSpawnsLoop], $@RandomThrityoneNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableThrityoneSpawnsLoop, ($@DisableThrityoneSpawnsLoop + 1);
    if ($@NodeManagerThrityoneSpawnMax > $@DisableThrityoneSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerThrityoneSpawnCount, ($@NodeManagerThrityoneSpawnCount - 1);
    if ($@NodeManagerThrityoneSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableThrityoneSpawnsLoop, 0;
    set $@NodeManagerThrityoneSpawnMax, 4;
    set $@NodeManagerThrityoneSpawnCount, 4;
    setarray $@NodeManagerThrityoneSpawn, 192, 193, 194, 195, 196, 197, 198, 199;
    cleararray $@NodesThrityoneSpawned, "", getarraysize($@NodesThrityoneSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
016-1.gat,68,39,0|script|#Node192|601,
{
    set @NodeId, 192;
    set @NodeManagerId, 31;
    setarray @npc_loc, 68, 39, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,94,29,0|script|#Node193|601,
{
    set @NodeId, 193;
    set @NodeManagerId, 31;
    setarray @npc_loc, 94, 29, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,96,52,0|script|#Node194|601,
{
    set @NodeId, 194;
    set @NodeManagerId, 31;
    setarray @npc_loc, 96, 52, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,84,58,0|script|#Node195|601,
{
    set @NodeId, 195;
    set @NodeManagerId, 31;
    setarray @npc_loc, 84, 58, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,76,82,0|script|#Node196|601,
{
    set @NodeId, 196;
    set @NodeManagerId, 31;
    setarray @npc_loc, 76, 82, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,52,79,0|script|#Node197|601,
{
    set @NodeId, 197;
    set @NodeManagerId, 31;
    setarray @npc_loc, 52, 79, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,32,81,0|script|#Node198|601,
{
    set @NodeId, 198;
    set @NodeManagerId, 31;
    setarray @npc_loc, 32, 81, 2;
    callfunc "MauvePlant";
    end;
}

// Gather Node NPC
016-1.gat,33,52,0|script|#Node199|601,
{
    set @NodeId, 199;
    set @NodeManagerId, 31;
    setarray @npc_loc, 33, 52, 2;
    callfunc "MauvePlant";
    end;
}
