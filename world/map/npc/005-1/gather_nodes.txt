// Mining Nodes
// Author: wushin

// NodeManager
005-1.gat,0,0,0|script|#NodeManager21|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesTwentyoneSpawned, "", getarraysize($@NodesTwentyoneSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomTwentyoneNodeLoop, 0;
    set $@RandomTwentyoneNode, rand(getarraysize($@NodeManagerTwentyoneSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomTwentyoneNode == $@NodesTwentyoneSpawned[$@RandomTwentyoneNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomTwentyoneNodeLoop, ($@RandomTwentyoneNodeLoop + 1);
    if ($@RandomTwentyoneNodeLoop >= getarraysize($@NodesTwentyoneSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerTwentyoneSpawn[$@RandomTwentyoneNode];
    setarray $@NodesTwentyoneSpawned[$@NodeManagerTwentyoneSpawnCount], $@RandomTwentyoneNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerTwentyoneSpawnCount, ($@NodeManagerTwentyoneSpawnCount + 1);
    if ($@NodeManagerTwentyoneSpawnMax > $@NodeManagerTwentyoneSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomTwentyoneNodeLoop, 0;
    set $@RandomTwentyoneNode, rand(getarraysize($@NodeManagerTwentyoneSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomTwentyoneNode == $@NodesTwentyoneSpawned[$@RandomTwentyoneNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomTwentyoneNodeLoop, ($@RandomTwentyoneNodeLoop + 1);
    if ($@RandomTwentyoneNodeLoop >= getarraysize($@NodesTwentyoneSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerTwentyoneSpawn[$@RandomTwentyoneNode];
    setarray $@NodesTwentyoneSpawned[$@DisableTwentyoneSpawnsLoop], $@RandomTwentyoneNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableTwentyoneSpawnsLoop, ($@DisableTwentyoneSpawnsLoop + 1);
    if ($@NodeManagerTwentyoneSpawnMax > $@DisableTwentyoneSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerTwentyoneSpawnCount, ($@NodeManagerTwentyoneSpawnCount - 1);
    if ($@NodeManagerTwentyoneSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableTwentyoneSpawnsLoop, 0;
    set $@NodeManagerTwentyoneSpawnMax, 3;
    set $@NodeManagerTwentyoneSpawnCount, 3;
    setarray $@NodeManagerTwentyoneSpawn, 121, 122, 123, 124, 125, 126;
    cleararray $@NodesTwentyoneSpawned, "", getarraysize($@NodesTwentyoneSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
005-1.gat,72,23,0|script|#Node121|607,
{
    set @NodeId, 121;
    set @NodeManagerId, 21;
    setarray @npc_loc, 73, 23, 2;
    callfunc "PricklyPear";
    end;
}

// Gather Node NPC
005-1.gat,77,14,0|script|#Node122|607,
{
    set @NodeId, 122;
    set @NodeManagerId, 21;
    setarray @npc_loc, 77, 14, 2;
    callfunc "PricklyPear";
    end;
}

// Gather Node NPC
005-1.gat,90,92,0|script|#Node123|607,
{
    set @NodeId, 123;
    set @NodeManagerId, 21;
    setarray @npc_loc, 90, 92, 2;
    callfunc "PricklyPear";
    end;
}

// Gather Node NPC
005-1.gat,103,63,0|script|#Node124|607,
{
    set @NodeId, 124;
    set @NodeManagerId, 21;
    setarray @npc_loc, 103, 63, 2;
    callfunc "PricklyPear";
    end;
}

// Gather Node NPC
005-1.gat,167,51,0|script|#Node125|607,
{
    set @NodeId, 125;
    set @NodeManagerId, 21;
    setarray @npc_loc, 167, 51, 2;
    callfunc "PricklyPear";
    end;
}

// Gather Node NPC
005-1.gat,47,47,0|script|#Node126|607,
{
    set @NodeId, 126;
    set @NodeManagerId, 21;
    setarray @npc_loc, 47, 47, 2;
    callfunc "PricklyPear";
    end;
}
// NodeManager
005-1.gat,0,0,0|script|#NodeManager61|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesSixtyoneSpawned, "", getarraysize($@NodesSixtyoneSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomSixtyoneNodeLoop, 0;
    set $@RandomSixtyoneNode, rand(getarraysize($@NodeManagerSixtyoneSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomSixtyoneNode == $@NodesSixtyoneSpawned[$@RandomSixtyoneNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomSixtyoneNodeLoop, ($@RandomSixtyoneNodeLoop + 1);
    if ($@RandomSixtyoneNodeLoop >= getarraysize($@NodesSixtyoneSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerSixtyoneSpawn[$@RandomSixtyoneNode];
    setarray $@NodesSixtyoneSpawned[$@NodeManagerSixtyoneSpawnCount], $@RandomSixtyoneNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerSixtyoneSpawnCount, ($@NodeManagerSixtyoneSpawnCount + 1);
    if ($@NodeManagerSixtyoneSpawnMax > $@NodeManagerSixtyoneSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomSixtyoneNodeLoop, 0;
    set $@RandomSixtyoneNode, rand(getarraysize($@NodeManagerSixtyoneSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomSixtyoneNode == $@NodesSixtyoneSpawned[$@RandomSixtyoneNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomSixtyoneNodeLoop, ($@RandomSixtyoneNodeLoop + 1);
    if ($@RandomSixtyoneNodeLoop >= getarraysize($@NodesSixtyoneSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerSixtyoneSpawn[$@RandomSixtyoneNode];
    setarray $@NodesSixtyoneSpawned[$@DisableSixtyoneSpawnsLoop], $@RandomSixtyoneNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableSixtyoneSpawnsLoop, ($@DisableSixtyoneSpawnsLoop + 1);
    if ($@NodeManagerSixtyoneSpawnMax > $@DisableSixtyoneSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerSixtyoneSpawnCount, ($@NodeManagerSixtyoneSpawnCount - 1);
    if ($@NodeManagerSixtyoneSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableSixtyoneSpawnsLoop, 0;
    set $@NodeManagerSixtyoneSpawnMax, 3;
    set $@NodeManagerSixtyoneSpawnCount, 3;
    setarray $@NodeManagerSixtyoneSpawn, 399, 400, 401, 402, 403, 404;
    cleararray $@NodesSixtyoneSpawned, "", getarraysize($@NodesSixtyoneSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}
// Gather Node NPC
005-1.gat,70,36,0|script|#Node399|604,
{
    set @NodeId, 399;
    set @NodeManagerId, 61;
    setarray @npc_loc, 70, 36, 2;
    callfunc "AlizarinPlant";
    end;
}
// Gather Node NPC
005-1.gat,84,71,0|script|#Node400|604,
{
    set @NodeId, 400;
    set @NodeManagerId, 61;
    setarray @npc_loc, 84, 71, 2;
    callfunc "AlizarinPlant";
    end;
}
// Gather Node NPC
005-1.gat,109,71,0|script|#Node401|604,
{
    set @NodeId, 401;
    set @NodeManagerId, 61;
    setarray @npc_loc, 109, 71, 2;
    callfunc "AlizarinPlant";
    end;
}
// Gather Node NPC
005-1.gat,105,44,0|script|#Node402|604,
{
    set @NodeId, 402;
    set @NodeManagerId, 61;
    setarray @npc_loc, 105, 44, 2;
    callfunc "AlizarinPlant";
    end;
}
// Gather Node NPC
005-1.gat,88,7,0|script|#Node403|604,
{
    set @NodeId, 403;
    set @NodeManagerId, 61;
    setarray @npc_loc, 88, 7, 2;
    callfunc "AlizarinPlant";
    end;
}
// Gather Node NPC
005-1.gat,162,92,0|script|#Node404|604,
{
    set @NodeId, 404;
    set @NodeManagerId, 61;
    setarray @npc_loc, 162, 92, 2;
    callfunc "AlizarinPlant";
    end;
}
