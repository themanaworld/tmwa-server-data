// Mining Nodes
// Author: wushin

// NodeManager
025-1.gat,0,0,0|script|#NodeManager36|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesThritysixSpawned, "", getarraysize($@NodesThritysixSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomThritysixNodeLoop, 0;
    set $@RandomThritysixNode, rand(getarraysize($@NodeManagerThritysixSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomThritysixNode == $@NodesThritysixSpawned[$@RandomThritysixNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomThritysixNodeLoop, ($@RandomThritysixNodeLoop + 1);
    if ($@RandomThritysixNodeLoop >= getarraysize($@NodesThritysixSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerThritysixSpawn[$@RandomThritysixNode];
    setarray $@NodesThritysixSpawned[$@NodeManagerThritysixSpawnCount], $@RandomThritysixNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerThritysixSpawnCount, ($@NodeManagerThritysixSpawnCount + 1);
    if ($@NodeManagerThritysixSpawnMax > $@NodeManagerThritysixSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomThritysixNodeLoop, 0;
    set $@RandomThritysixNode, rand(getarraysize($@NodeManagerThritysixSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomThritysixNode == $@NodesThritysixSpawned[$@RandomThritysixNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomThritysixNodeLoop, ($@RandomThritysixNodeLoop + 1);
    if ($@RandomThritysixNodeLoop >= getarraysize($@NodesThritysixSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerThritysixSpawn[$@RandomThritysixNode];
    setarray $@NodesThritysixSpawned[$@DisableThritysixSpawnsLoop], $@RandomThritysixNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableThritysixSpawnsLoop, ($@DisableThritysixSpawnsLoop + 1);
    if ($@NodeManagerThritysixSpawnMax > $@DisableThritysixSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerThritysixSpawnCount, ($@NodeManagerThritysixSpawnCount - 1);
    if ($@NodeManagerThritysixSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableThritysixSpawnsLoop, 0;
    set $@NodeManagerThritysixSpawnMax, 5;
    set $@NodeManagerThritysixSpawnCount, 5;
    setarray $@NodeManagerThritysixSpawn, 228, 229, 230, 231, 232, 233, 234, 235, 236;
    cleararray $@NodesThritysixSpawned, "", getarraysize($@NodesThritysixSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
025-1.gat,29,25,0|script|#Node228|603,
{
    set @NodeId, 228;
    set @NodeManagerId, 36;
    setarray @npc_loc, 29, 25, 2;
    callfunc "GambrogePlant";
    end;
}

// Gather Node NPC
025-1.gat,109,21,0|script|#Node229|603,
{
    set @NodeId, 229;
    set @NodeManagerId, 36;
    setarray @npc_loc, 109, 21, 2;
    callfunc "GambrogePlant";
    end;
}

// Gather Node NPC
025-1.gat,103,60,0|script|#Node230|603,
{
    set @NodeId, 230;
    set @NodeManagerId, 36;
    setarray @npc_loc, 103, 60, 2;
    callfunc "GambrogePlant";
    end;
}

// Gather Node NPC
025-1.gat,60,95,0|script|#Node231|603,
{
    set @NodeId, 231;
    set @NodeManagerId, 36;
    setarray @npc_loc, 60, 95, 2;
    callfunc "GambrogePlant";
    end;
}

// Gather Node NPC
025-1.gat,23,91,0|script|#Node232|603,
{
    set @NodeId, 232;
    set @NodeManagerId, 36;
    setarray @npc_loc, 23, 91, 2;
    callfunc "GambrogePlant";
    end;
}

// Gather Node NPC
025-1.gat,89,52,0|script|#Node233|603,
{
    set @NodeId, 233;
    set @NodeManagerId, 36;
    setarray @npc_loc, 89, 52, 2;
    callfunc "GambrogePlant";
    end;
}
// Gather Node NPC
025-1.gat,71,54,0|script|#Node234|606,
{
    set @NodeId, 234;
    set @NodeManagerId, 36;
    setarray @npc_loc, 71, 54, 2;
    callfunc "CloverPatch";
    end;
}
// Gather Node NPC
025-1.gat,159,15,0|script|#Node235|606,
{
    set @NodeId, 235;
    set @NodeManagerId, 36;
    setarray @npc_loc, 159, 15, 2;
    callfunc "CloverPatch";
    end;
}
// Gather Node NPC
025-1.gat,52,61,0|script|#Node236|605,
{
    set @NodeId, 236;
    set @NodeManagerId, 36;
    setarray @npc_loc, 52, 61, 2;
    callfunc "CloverPatch";
    end;
}
