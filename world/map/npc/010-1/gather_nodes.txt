// Mining Nodes
// Author: wushin
// NodeManager
010-1.gat,0,0,0|script|#NodeManager25|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesTwentyfiveSpawned, "", getarraysize($@NodesTwentyfiveSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomTwentyfiveNodeLoop, 0;
    set $@RandomTwentyfiveNode, rand(getarraysize($@NodeManagerTwentyfiveSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomTwentyfiveNode == $@NodesTwentyfiveSpawned[$@RandomTwentyfiveNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomTwentyfiveNodeLoop, ($@RandomTwentyfiveNodeLoop + 1);
    if ($@RandomTwentyfiveNodeLoop >= getarraysize($@NodesTwentyfiveSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerTwentyfiveSpawn[$@RandomTwentyfiveNode];
    setarray $@NodesTwentyfiveSpawned[$@NodeManagerTwentyfiveSpawnCount], $@RandomTwentyfiveNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerTwentyfiveSpawnCount, ($@NodeManagerTwentyfiveSpawnCount + 1);
    if ($@NodeManagerTwentyfiveSpawnMax > $@NodeManagerTwentyfiveSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomTwentyfiveNodeLoop, 0;
    set $@RandomTwentyfiveNode, rand(getarraysize($@NodeManagerTwentyfiveSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomTwentyfiveNode == $@NodesTwentyfiveSpawned[$@RandomTwentyfiveNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomTwentyfiveNodeLoop, ($@RandomTwentyfiveNodeLoop + 1);
    if ($@RandomTwentyfiveNodeLoop >= getarraysize($@NodesTwentyfiveSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerTwentyfiveSpawn[$@RandomTwentyfiveNode];
    setarray $@NodesTwentyfiveSpawned[$@DisableTwentyfiveSpawnsLoop], $@RandomTwentyfiveNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableTwentyfiveSpawnsLoop, ($@DisableTwentyfiveSpawnsLoop + 1);
    if ($@NodeManagerTwentyfiveSpawnMax > $@DisableTwentyfiveSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerTwentyfiveSpawnCount, ($@NodeManagerTwentyfiveSpawnCount - 1);
    if ($@NodeManagerTwentyfiveSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableTwentyfiveSpawnsLoop, 0;
    set $@NodeManagerTwentyfiveSpawnMax, 3;
    set $@NodeManagerTwentyfiveSpawnCount, 3;
    setarray $@NodeManagerTwentyfiveSpawn, 145, 146, 147, 148, 149, 150;
    cleararray $@NodesTwentyfiveSpawned, "", getarraysize($@NodesTwentyfiveSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}
// Gather Node NPC
010-1.gat,104,28,0|script|#Node145|601,
{
    set @NodeId, 145;
    set @NodeManagerId, 25;
    setarray @npc_loc, 104, 28, 2;
    callfunc "MauvePlant";
    end;
}
// Gather Node NPC
010-1.gat,129,99,0|script|#Node146|601,
{
    set @NodeId, 146;
    set @NodeManagerId, 25;
    setarray @npc_loc, 129, 99, 2;
    callfunc "MauvePlant";
    end;
}
// Gather Node NPC
010-1.gat,80,69,0|script|#Node147|601,
{
    set @NodeId, 147;
    set @NodeManagerId, 25;
    setarray @npc_loc, 80, 69, 2;
    callfunc "MauvePlant";
    end;
}
// Gather Node NPC
010-1.gat,20,88,0|script|#Node148|601,
{
    set @NodeId, 148;
    set @NodeManagerId, 25;
    setarray @npc_loc, 20, 88, 2;
    callfunc "MauvePlant";
    end;
}
// Gather Node NPC
010-1.gat,28,32,0|script|#Node149|601,
{
    set @NodeId, 149;
    set @NodeManagerId, 25;
    setarray @npc_loc, 28, 32, 2;
    callfunc "MauvePlant";
    end;
}
// Gather Node NPC
010-1.gat,61,65,0|script|#Node150|601,
{
    set @NodeId, 150;
    set @NodeManagerId, 25;
    setarray @npc_loc, 61, 65, 2;
    callfunc "MauvePlant";
    end;
}
