// Mining Nodes
// Author: wushin

// NodeManager
009-3.gat,0,0,0|script|#NodeManager14|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesFourteenSpawned, "", getarraysize($@NodesFourteenSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomFourteenNodeLoop, 0;
    set $@RandomFourteenNode, rand(getarraysize($@NodeManagerFourteenSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomFourteenNode == $@NodesFourteenSpawned[$@RandomFourteenNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomFourteenNodeLoop, ($@RandomFourteenNodeLoop + 1);
    if ($@RandomFourteenNodeLoop >= getarraysize($@NodesFourteenSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerFourteenSpawn[$@RandomFourteenNode];
    setarray $@NodesFourteenSpawned[$@NodeManagerFourteenSpawnCount], $@RandomFourteenNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerFourteenSpawnCount, ($@NodeManagerFourteenSpawnCount + 1);
    if ($@NodeManagerFourteenSpawnMax > $@NodeManagerFourteenSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomFourteenNodeLoop, 0;
    set $@RandomFourteenNode, rand(getarraysize($@NodeManagerFourteenSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomFourteenNode == $@NodesFourteenSpawned[$@RandomFourteenNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomFourteenNodeLoop, ($@RandomFourteenNodeLoop + 1);
    if ($@RandomFourteenNodeLoop >= getarraysize($@NodesFourteenSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerFourteenSpawn[$@RandomFourteenNode];
    setarray $@NodesFourteenSpawned[$@DisableFourteenSpawnsLoop], $@RandomFourteenNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableFourteenSpawnsLoop, ($@DisableFourteenSpawnsLoop + 1);
    if ($@NodeManagerFourteenSpawnMax > $@DisableFourteenSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerFourteenSpawnCount, ($@NodeManagerFourteenSpawnCount - 1);
    if ($@NodeManagerFourteenSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableFourteenSpawnsLoop, 0;
    set $@NodeManagerFourteenSpawnMax, 3;
    set $@NodeManagerFourteenSpawnCount, 3;
    setarray $@NodeManagerFourteenSpawn, 79, 80, 81, 82, 83, 84;
    cleararray $@NodesFourteenSpawned, "", getarraysize($@NodesFourteenSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
009-3.gat,20,101,0|script|#Node79|501,
{
    set @NodeId, 79;
    set @NodeManagerId, 14;
    setarray @npc_loc, 20, 101, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
009-3.gat,131,92,0|script|#Node80|501,
{
    set @NodeId, 80;
    set @NodeManagerId, 14;
    setarray @npc_loc, 131, 92, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
009-3.gat,140,73,0|script|#Node81|501,
{
    set @NodeId, 81;
    set @NodeManagerId, 14;
    setarray @npc_loc, 140, 73, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
009-3.gat,123,106,0|script|#Node82|501,
{
    set @NodeId, 82;
    set @NodeManagerId, 14;
    setarray @npc_loc, 123, 106, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
009-3.gat,33,52,0|script|#Node83|501,
{
    set @NodeId, 83;
    set @NodeManagerId, 14;
    setarray @npc_loc, 33, 52, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
009-3.gat,46,87,0|script|#Node84|501,
{
    set @NodeId, 84;
    set @NodeManagerId, 14;
    setarray @npc_loc, 46, 87, 2;
    callfunc "CoalVein";
    end;
}
