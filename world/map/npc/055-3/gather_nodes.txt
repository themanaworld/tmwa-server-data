// Mining Nodes
// Author: wushin

// NodeManager
055-3.gat,0,0,0|script|#NodeManager17|400,
{
    end;

OnTimer25000:
    stopnpctimer;
    cleararray $@NodesSeventeenSpawned, "", getarraysize($@NodesSeventeenSpawned);
    goto L_EnableSpawns;

L_EnableSpawns:
    set $@RandomSeventeenNodeLoop, 0;
    set $@RandomSeventeenNode, rand(getarraysize($@NodeManagerSeventeenSpawn));
    goto L_CheckNotEnabled;

L_CheckNotEnabled:
    if ($@RandomSeventeenNode == $@NodesSeventeenSpawned[$@RandomSeventeenNodeLoop])
        goto L_EnableSpawns;
    goto L_CheckNotEnabledLoop;

L_CheckNotEnabledLoop:
    set $@RandomSeventeenNodeLoop, ($@RandomSeventeenNodeLoop + 1);
    if ($@RandomSeventeenNodeLoop >= getarraysize($@NodesSeventeenSpawned))
        goto L_Enable;
    goto L_CheckNotEnabled;

L_Enable:
    enablenpc "#Node"+$@NodeManagerSeventeenSpawn[$@RandomSeventeenNode];
    setarray $@NodesSeventeenSpawned[$@NodeManagerSeventeenSpawnCount], $@RandomSeventeenNode;
    goto L_EnableCheck;

L_EnableCheck:
    set $@NodeManagerSeventeenSpawnCount, ($@NodeManagerSeventeenSpawnCount + 1);
    if ($@NodeManagerSeventeenSpawnMax > $@NodeManagerSeventeenSpawnCount)
        goto L_EnableSpawns;
    goto L_End;
 
L_Start:
    initnpctimer;
    goto L_End;

L_DisableSpawns:
    set $@RandomSeventeenNodeLoop, 0;
    set $@RandomSeventeenNode, rand(getarraysize($@NodeManagerSeventeenSpawn));
    goto L_CheckNotDisabled;

L_CheckNotDisabled:
    if ($@RandomSeventeenNode == $@NodesSeventeenSpawned[$@RandomSeventeenNodeLoop])
        goto L_DisableSpawns;
    goto L_CheckNotDisabledLoop;

L_CheckNotDisabledLoop:
    set $@RandomSeventeenNodeLoop, ($@RandomSeventeenNodeLoop + 1);
    if ($@RandomSeventeenNodeLoop >= getarraysize($@NodesSeventeenSpawned))
        goto L_Disable;
    goto L_CheckNotDisabled;

L_Disable:
    disablenpc "#Node"+$@NodeManagerSeventeenSpawn[$@RandomSeventeenNode];
    setarray $@NodesSeventeenSpawned[$@DisableSeventeenSpawnsLoop], $@RandomSeventeenNode;
    goto L_DisableCheck;

L_DisableCheck:
    set $@DisableSeventeenSpawnsLoop, ($@DisableSeventeenSpawnsLoop + 1);
    if ($@NodeManagerSeventeenSpawnMax > $@DisableSeventeenSpawnsLoop)
        goto L_DisableSpawns;
    goto L_End;

OnCommandTally:
    set $@NodeManagerSeventeenSpawnCount, ($@NodeManagerSeventeenSpawnCount - 1);
    if ($@NodeManagerSeventeenSpawnCount)
        goto L_End;
    goto L_Start;

OnInit:
    set $@DisableSeventeenSpawnsLoop, 0;
    set $@NodeManagerSeventeenSpawnMax, 3;
    set $@NodeManagerSeventeenSpawnCount, 3;
    setarray $@NodeManagerSeventeenSpawn, 97, 98, 99, 100, 101, 102;
    cleararray $@NodesSeventeenSpawned, "", getarraysize($@NodesSeventeenSpawned);
    goto L_DisableSpawns;

L_End:
    end;
}

// Gather Node NPC
055-3.gat,91,14,0|script|#Node97|501,
{
    set @NodeId, 97;
    set @NodeManagerId, 17;
    setarray @npc_loc, 91, 14, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
055-3.gat,27,43,0|script|#Node98|501,
{
    set @NodeId, 98;
    set @NodeManagerId, 17;
    setarray @npc_loc, 27, 43, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
055-3.gat,52,69,0|script|#Node99|501,
{
    set @NodeId, 99;
    set @NodeManagerId, 17;
    setarray @npc_loc, 52, 69, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
055-3.gat,128,118,0|script|#Node100|501,
{
    set @NodeId, 100;
    set @NodeManagerId, 17;
    setarray @npc_loc, 128, 118, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
055-3.gat,121,62,0|script|#Node101|501,
{
    set @NodeId, 101;
    set @NodeManagerId, 17;
    setarray @npc_loc, 121, 62, 2;
    callfunc "CoalVein";
    end;
}

// Gather Node NPC
055-3.gat,77,28,0|script|#Node102|501,
{
    set @NodeId, 102;
    set @NodeManagerId, 17;
    setarray @npc_loc, 77, 28, 2;
    callfunc "CoalVein";
    end;
}
